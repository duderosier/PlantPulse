<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plant Inspection Scanner</title><script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:#1a1a1a;color:#fff;overflow-x:hidden}.container{max-width:100vw;margin:0 auto;padding:10px}.header{text-align:center;padding:20px 0;background:linear-gradient(135deg,#2c3e50,#3498db);margin-bottom:20px;border-radius:10px}.header h1{font-size:1.5em;margin-bottom:5px}.status{background:#34495e;padding:15px;border-radius:8px;margin-bottom:20px;text-align:center}.scanner-container{position:relative;margin-bottom:20px;border-radius:10px;overflow:hidden;background:#2c3e50;width:100%;height:300px}#scanner{width:100%;height:100%;background:#2c3e50;display:flex;align-items:center;justify-content:center;color:#bdc3c7;position:relative;overflow:hidden}#scanner video{width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0}#scanner canvas{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}.scanner-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:60%;border:2px solid #e74c3c;border-radius:10px;pointer-events:none}.scanner-overlay::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60%;height:2px;background:#e74c3c;animation:scan 2s linear infinite}@keyframes scan{0%,100%{opacity:.3}50%{opacity:1}}.controls{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}button{flex:1;min-width:120px;padding:15px;border:none;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;transition:all .3s ease}.btn-primary{background:#3498db;color:white}.btn-primary:hover{background:#2980b9}.btn-success{background:#27ae60;color:white}.btn-success:hover{background:#229954}.btn-danger{background:#e74c3c;color:white}.btn-danger:hover{background:#c0392b}.btn-secondary{background:#95a5a6;color:white}.btn-secondary:hover{background:#7f8c8d}.inspection-form{background:#34495e;padding:20px;border-radius:10px;margin-bottom:20px;display:none}.inspection-form.active{display:block}.form-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:bold}input,textarea,select{width:100%;padding:12px;border:1px solid #7f8c8d;border-radius:5px;font-size:16px;background:#2c3e50;color:#fff}input::placeholder,textarea::placeholder{color:#bdc3c7}textarea{resize:vertical;min-height:80px}.barcode-display{background:#2c3e50;padding:15px;border-radius:8px;margin-bottom:20px;text-align:center;font-size:18px;font-weight:bold;border:2px solid #3498db}.log-section{background:#34495e;padding:20px;border-radius:10px;margin-bottom:20px}.log-entry{background:#2c3e50;padding:10px;margin-bottom:10px;border-radius:5px;border-left:4px solid #3498db}.log-entry.sat{border-left-color:#27ae60}.log-entry.unsat{border-left-color:#e74c3c}.log-entry-header{font-weight:bold;margin-bottom:5px}.log-entry-details{font-size:14px;color:#bdc3c7}.export-controls{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}.flash{animation:flash .3s ease-in-out}@keyframes flash{0%,100%{background-color:inherit}50%{background-color:#3498db}}.hidden{display:none!important}@media (max-width:480px){.container{padding:5px}.controls{flex-direction:column}button{min-width:unset}}</style></head><body><div class="container"><div class="header"><h1>üè≠ Plant Inspection Scanner</h1><p>Coal Plant Equipment Rounds - QR Code Scanner</p></div><div class="status" id="status">Ready to scan QR codes</div><div class="scanner-container"><div id="scanner"><p>Click "Start Camera" to begin scanning QR codes</p></div><div class="scanner-overlay"></div></div><div class="controls"><button id="startBtn" class="btn-primary">Start Camera</button><button id="stopBtn" class="btn-secondary" disabled>Stop Camera</button><button id="clearLogBtn" class="btn-danger">Clear Log</button></div><div id="barcodeDisplay" class="barcode-display hidden"><div>Last Scanned: <span id="lastBarcode">None</span></div></div><div id="inspectionForm" class="inspection-form"><h3>Inspection Details</h3><div class="form-group"><label>QR Code Data:</label><input type="text" id="barcodeData" readonly></div><div class="form-group"><label>Location Description:</label><input type="text" id="locationCode" placeholder="e.g., 8th Floor Door #1" required></div><div class="form-group"><label>Status:</label><select id="inspectionStatus"><option value="">Select Status</option><option value="SAT">SAT (Satisfactory)</option><option value="UNSAT">UNSAT (Unsatisfactory)</option></select></div><div class="form-group" id="readingGroup"><label>Reading (Optional):</label><input type="text" id="reading" placeholder="Enter equipment reading"></div><div class="form-group hidden" id="notesGroup"><label>Notes (Required for UNSAT):</label><textarea id="notes" placeholder="Describe the issue or condition"></textarea></div><div class="controls"><button id="submitBtn" class="btn-success">Submit Inspection</button><button id="cancelBtn" class="btn-secondary">Cancel</button></div></div><div class="log-section"><h3>Inspection Log</h3><div id="logContainer"><p>No inspections recorded yet.</p></div><div class="export-controls"><button id="exportBtn" class="btn-primary">Export Log</button><button id="downloadBtn" class="btn-success">Download TXT</button></div></div></div><script>class InspectionApp{constructor(){this.isScanning=false;this.currentBarcode=null;this.inspectionLog=this.loadLog();this.initializeElements();this.bindEvents();this.updateLogDisplay()}initializeElements(){this.startBtn=document.getElementById('startBtn');this.stopBtn=document.getElementById('stopBtn');this.clearLogBtn=document.getElementById('clearLogBtn');this.status=document.getElementById('status');this.scanner=document.getElementById('scanner');this.barcodeDisplay=document.getElementById('barcodeDisplay');this.lastBarcode=document.getElementById('lastBarcode');this.inspectionForm=document.getElementById('inspectionForm');this.barcodeData=document.getElementById('barcodeData');this.locationCode=document.getElementById('locationCode');this.inspectionStatus=document.getElementById('inspectionStatus');this.reading=document.getElementById('reading');this.notes=document.getElementById('notes');this.readingGroup=document.getElementById('readingGroup');this.notesGroup=document.getElementById('notesGroup');this.submitBtn=document.getElementById('submitBtn');this.cancelBtn=document.getElementById('cancelBtn');this.exportBtn=document.getElementById('exportBtn');this.downloadBtn=document.getElementById('downloadBtn');this.logContainer=document.getElementById('logContainer')}bindEvents(){this.startBtn.addEventListener('click',()=>this.startScanning());this.stopBtn.addEventListener('click',()=>this.stopScanning());this.clearLogBtn.addEventListener('click',()=>this.clearLog());this.inspectionStatus.addEventListener('change',()=>this.handleStatusChange());this.submitBtn.addEventListener('click',()=>this.submitInspection());this.cancelBtn.addEventListener('click',()=>this.cancelInspection());this.exportBtn.addEventListener('click',()=>this.exportLog());this.downloadBtn.addEventListener('click',()=>this.downloadLog())}async startScanning(){try{this.updateStatus('Requesting camera permissions...','info');const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1280},height:{ideal:720}}});stream.getTracks().forEach(track=>track.stop());this.updateStatus('Camera permission granted. Initializing scanner...','success');Quagga.init({inputStream:{name:"Live",type:"LiveStream",target:this.scanner,constraints:{width:{min:640,ideal:1280},height:{min:480,ideal:720},facingMode:"environment",aspectRatio:{ideal:16/9}},area:{top:"0%",right:"0%",left:"0%",bottom:"0%"}},decoder:{readers:["qr_reader"],debug:{drawBoundingBox:true,showFrequency:false,drawScanline:false,showPattern:false}},locate:true,locator:{halfSample:false,patchSize:"large"},numOfWorkers:navigator.hardwareConcurrency||4,frequency:10},(err)=>{if(err){console.error(err);this.updateStatus('Error initializing scanner: '+err.message,'error');return}Quagga.start();this.isScanning=true;this.startBtn.disabled=true;this.stopBtn.disabled=false;this.updateStatus('Camera active - Point at QR code to scan')});Quagga.onDetected((data)=>{if(this.isScanning){this.handleBarcodeDetected(data)}})}catch(error){console.error('Camera error:',error);let errorMessage='Camera access failed. ';if(error.name==='NotAllowedError'){errorMessage+='Please allow camera permissions and try again.'}else if(error.name==='NotFoundError'){errorMessage+='No camera found on this device.'}else if(error.name==='NotSupportedError'){errorMessage+='Camera not supported in this browser.'}else{errorMessage+=error.message}this.updateStatus(errorMessage,'error')}}stopScanning(){if(this.isScanning){Quagga.stop();this.isScanning=false;this.startBtn.disabled=false;this.stopBtn.disabled=true;this.scanner.innerHTML='<p>Click "Start Camera" to begin scanning QR codes</p>';this.updateStatus('Camera stopped')}}handleBarcodeDetected(data){const barcode=data.codeResult.code;const confidence=data.codeResult.decodedCodes.reduce((sum,code)=>sum+(code.confidence||0),0);if(confidence<20){return}if(this.currentBarcode===barcode)return;if(navigator.vibrate){navigator.vibrate(200)}this.currentBarcode=barcode;this.lastBarcode.textContent=barcode;this.barcodeDisplay.classList.remove('hidden');this.barcodeDisplay.classList.add('flash');setTimeout(()=>{this.barcodeDisplay.classList.remove('flash')},300);this.showInspectionForm(barcode);this.updateStatus(`‚úÖ QR Code scanned: ${barcode}`,'success');this.stopScanning()}showInspectionForm(qrData){this.barcodeData.value=qrData;this.locationCode.value=qrData;this.inspectionStatus.value='';this.reading.value='';this.notes.value='';this.readingGroup.classList.remove('hidden');this.notesGroup.classList.add('hidden');this.inspectionForm.classList.add('active');setTimeout(()=>{this.inspectionStatus.focus()},100)}handleStatusChange(){const status=this.inspectionStatus.value;if(status==='SAT'){this.readingGroup.classList.remove('hidden');this.notesGroup.classList.add('hidden')}else if(status==='UNSAT'){this.readingGroup.classList.add('hidden');this.notesGroup.classList.remove('hidden')}else{this.readingGroup.classList.remove('hidden');this.notesGroup.classList.add('hidden')}}submitInspection(){const barcodeData=this.barcodeData.value;const locationCode=this.locationCode.value.trim();const status=this.inspectionStatus.value;const reading=this.reading.value.trim();const notes=this.notes.value.trim();if(!locationCode){alert('Please enter a location description');return}if(!status){alert('Please select inspection status (SAT/UNSAT)');return}if(status==='UNSAT'&&!notes){alert('Notes are required for UNSAT inspections');return}const inspection={barcodeData,locationCode,status,reading:status==='SAT'?reading:'',notes:status==='UNSAT'?notes:'',timestamp:new Date().toISOString(),dateTime:new Date().toLocaleString()};this.inspectionLog.push(inspection);this.saveLog();this.updateLogDisplay();this.cancelInspection();this.updateStatus(`Inspection recorded for ${locationCode}`)}cancelInspection(){this.inspectionForm.classList.remove('active');this.currentBarcode=null}loadLog(){const saved=window.inspectionLog||[];return saved}saveLog(){window.inspectionLog=this.inspectionLog}updateLogDisplay(){if(this.inspectionLog.length===0){this.logContainer.innerHTML='<p>No inspections recorded yet.</p>';return}let html='';const sortedLog=[...this.inspectionLog].reverse();sortedLog.forEach((entry,index)=>{const statusClass=entry.status.toLowerCase();html+=`<div class="log-entry ${statusClass}"><div class="log-entry-header">${entry.locationCode} - ${entry.status}</div><div class="log-entry-details"><div>QR Code: ${entry.barcodeData||entry.locationCode}</div><div>Date/Time: ${entry.dateTime}</div>${entry.reading?`<div>Reading: ${entry.reading}</div>`:''}${entry.notes?`<div>Notes: ${entry.notes}</div>`:''}</div></div>`});this.logContainer.innerHTML=html}clearLog(){if(confirm('Are you sure you want to clear all inspection logs? This cannot be undone.')){this.inspectionLog=[];this.saveLog();this.updateLogDisplay();this.updateStatus('Inspection log cleared')}}exportLog(){if(this.inspectionLog.length===0){alert('No inspections to export');return}let logText='COAL PLANT INSPECTION LOG\n';logText+='=========================\n\n';this.inspectionLog.forEach((entry)=>{logText+=`Location: ${entry.locationCode}\n`;logText+=`QR Code: ${entry.barcodeData||'N/A'}\n`;logText+=`Status: ${entry.status}\n`;logText+=`Date/Time: ${entry.dateTime}\n`;if(entry.reading){logText+=`Reading: ${entry.reading}\n`}if(entry.notes){logText+=`Notes: ${entry.notes}\n`}logText+='\n---\n\n'});navigator.clipboard.writeText(logText).then(()=>{this.updateStatus('Log copied to clipboard!')}).catch(()=>{this.updateStatus('Export complete (clipboard not available)')});alert('Log exported to clipboard!\n\nFirst few lines:\n'+logText.substring(0,200)+'...')}downloadLog(){if(this.inspectionLog.length===0){alert('No inspections to download');return}let logText='COAL PLANT INSPECTION LOG\n';logText+='=========================\n\n';this.inspectionLog.forEach((entry)=>{logText+=`Location: ${entry.locationCode}\n`;logText+=`QR Code: ${entry.barcodeData||'N/A'}\n`;logText+=`Status: ${entry.status}\n`;logText+=`Date/Time: ${entry.dateTime}\n`;if(entry.reading){logText+=`Reading: ${entry.reading}\n`}if(entry.notes){logText+=`Notes: ${entry.notes}\n`}logText+='\n---\n\n'});const blob=new Blob([logText],{type:'text/plain'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`plant_inspection_log_${new Date().toISOString().split('T')[0]}.txt`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);this.updateStatus('Log file downloaded!')}updateStatus(message,type='info'){this.status.textContent=message;this.status.className='status';if(type==='error'){this.status.style.background='#e74c3c'}else if(type==='success'){this.status.style.background='#27ae60'}else{this.status.style.background='#34495e'}}}let app;document.addEventListener('DOMContentLoaded',()=>{app=new InspectionApp()});document.addEventListener('visibilitychange',()=>{if(document.hidden&&app&&app.isScanning){app.stopScanning()}});</script></body></html>
